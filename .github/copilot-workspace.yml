# GitHub Copilot Workspace Configuration
# This file configures network access and other settings for GitHub Copilot Workspace

# Environment Setup
# Commands to run when the workspace starts to ensure dependencies are installed
setup:
  # Install Railway CLI if not already installed
  # Required for the Railway MCP server to function
  commands:
    - |
      if ! command -v railway > /dev/null 2>&1; then
        echo "Installing Railway CLI..."
        if npm install -g @railway/cli 2>&1; then
          echo "Railway CLI installed successfully: $(railway --version)"
        else
          npm_exit_code=$?
          echo "ERROR: Failed to install Railway CLI (npm exit code: $npm_exit_code)"
          echo "Railway MCP server will not be available in this workspace."
          echo "You can manually install it later with: npm install -g @railway/cli"
          # Exit with 0 to allow workspace startup to continue
          exit 0
        fi
      else
        echo "Railway CLI already installed: $(railway --version)"
      fi

# Network Configuration
# Allow Copilot Workspace to access Railway deployment URLs
network:
  allowed_domains:
    # Railway.app platform URLs
    - "*.up.railway.app"         # All Railway deployment URLs (production, staging, development, PR environments)
    - "railway.app"              # Railway dashboard and API
    - "backboard.railway.app"    # Railway GraphQL API
    
    # Yoto API URLs (for testing and development)
    - "api.yoto.io"              # Yoto REST API
    - "mqtt.yoto.io"             # Yoto MQTT broker
    - "yoto.dev"                 # Yoto developer portal
    
  description: |
    This configuration allows GitHub Copilot Workspace to access:
    - Railway deployment URLs (*.up.railway.app) for testing and validation
    - Railway platform APIs for deployment management
    - Yoto APIs for development and testing
    
    Railway URL patterns used in this project:
    - Production: https://yoto-smart-stream-production.up.railway.app
    - Staging: https://yoto-smart-stream-staging.up.railway.app
    - Development: https://yoto-smart-stream-development.up.railway.app
    - PR Environments: https://yoto-smart-stream-pr-{number}.up.railway.app

# MCP Servers Configuration
# Model Context Protocol servers provide specialized tools and capabilities
mcp_servers:
  railway-mcp-server:
    # Railway MCP Server provides Railway platform management tools
    # Documentation: https://github.com/railwayapp/railway-mcp-server
    command: npx
    args:
      - "-y"
      - "@railway/mcp-server"
    description: |
      Railway MCP Server provides tools for managing Railway infrastructure including:
      - Project and service management (list, create, link)
      - Deployment operations (deploy services, deploy templates)
      - Environment management (create, link environments)
      - Configuration (list/set variables, generate domains)
      - Monitoring (retrieve logs with filtering)
      
      Requires: Railway CLI installed and user logged in
      CLI Version: Automatically detects version for feature support
