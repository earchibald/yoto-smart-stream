# Railway.app Configuration for Yoto Smart Stream
# https://docs.railway.app/reference/config-as-code

[build]
# Use Nixpacks for automatic Python environment detection
builder = "NIXPACKS"
# Install dependencies from requirements.txt
buildCommand = "pip install -r requirements.txt"

[deploy]
# Start the production FastAPI server
# Railway provides $PORT environment variable automatically
# Using production entry point: yoto_smart_stream.api:app
startCommand = "uvicorn yoto_smart_stream.api:app --host 0.0.0.0 --port $PORT"

# Health check endpoint
healthcheckPath = "/api/health"
healthcheckTimeout = 100

# Restart policy
restartPolicyType = "ON_FAILURE"
restartPolicyMaxRetries = 10

# Watch patterns - trigger rebuild on changes to these files
watchPatterns = [
    "yoto_smart_stream/**/*.py",
    "requirements.txt",
    "pyproject.toml"
]

# Persistent volumes - survive deployments and restarts
# Store Yoto auth tokens and other persistent data
[[deploy.volumes]]
name = "data"
mountPath = "/data"
